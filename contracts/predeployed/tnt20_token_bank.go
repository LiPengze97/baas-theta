package predeployed

import (
	"encoding/hex"
	"math/big"

	"github.com/thetatoken/theta/common"
	"github.com/thetatoken/theta/crypto"
	"github.com/thetatoken/theta/ledger/types"

	"github.com/thetatoken/thetasubchain/core"
	slst "github.com/thetatoken/thetasubchain/ledger/state"
)

// Bytecode of the smart contracts hardcoded in the genesis block through pre-deployment
const TNT20TokenBankContractBytecode = "608060405234801561001057600080fd5b50600080819055506142ea806100276000396000f3fe608060405260043610620000aa5760003560e01c8063a2cc6981116200006d578063a2cc69811462000205578063b83f29011462000249578063ba2c329c1462000269578063c27d927a1462000297578063ebda996214620002c7578063f6a3d24e146200030b57620000aa565b80631527b14d14620000af578063261a323e14620000f457806327ca4df11462000138578063588b1408146200017c57806360569b5e14620001c0575b600080fd5b348015620000bc57600080fd5b50620000db6004803603810190620000d591906200163b565b6200034f565b604051620000eb92919062001a37565b60405180910390f35b3480156200010157600080fd5b506200012060048036038101906200011a91906200163b565b620003b6565b6040516200012f919062001b03565b60405180910390f35b3480156200014557600080fd5b506200016460048036038101906200015e919062001800565b620003ff565b60405162000173919062001a1a565b60405180910390f35b3480156200018957600080fd5b50620001a86004803603810190620001a2919062001800565b6200043f565b604051620001b7919062001b20565b60405180910390f35b348015620001cd57600080fd5b50620001ec6004803603810190620001e69190620015a5565b620004f4565b604051620001fc92919062001b44565b60405180910390f35b3480156200021257600080fd5b506200023160048036038101906200022b91906200163b565b620005b5565b60405162000240919062001a1a565b60405180910390f35b6200026760048036038101906200026191906200168c565b6200068b565b005b3480156200027657600080fd5b506200029560048036038101906200028f919062001707565b620008a5565b005b348015620002a457600080fd5b50620002af62000bdf565b604051620002be919062001c22565b60405180910390f35b348015620002d457600080fd5b50620002f36004803603810190620002ed9190620015a5565b62000be5565b60405162000302919062001b20565b60405180910390f35b3480156200031857600080fd5b50620003376004803603810190620003319190620015a5565b62000d1c565b60405162000346919062001b03565b60405180910390f35b6001818051602081018201805184825260208301602085012081835280955050505050506000915090508060000160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff16908060000160149054906101000a900460ff16905082565b600080620003c48362000d75565b9050600181604051620003d8919062001a01565b908152602001604051809103902060000160149054906101000a900460ff16915050919050565b600381815481106200041057600080fd5b906000526020600020016000915054906101000a900473ffffffffffffffffffffffffffffffffffffffff1681565b600481815481106200045057600080fd5b9060005260206000200160009150905080546200046d9062001edb565b80601f01602080910402602001604051908101604052809291908181526020018280546200049b9062001edb565b8015620004ec5780601f10620004c057610100808354040283529160200191620004ec565b820191906000526020600020905b815481529060010190602001808311620004ce57829003601f168201915b505050505081565b6002602052806000526040600020600091509050806000018054620005199062001edb565b80601f0160208091040260200160405190810160405280929190818152602001828054620005479062001edb565b8015620005985780601f106200056c5761010080835404028352916020019162000598565b820191906000526020600020905b8154815290600101906020018083116200057a57829003601f168201915b5050505050908060010160009054906101000a900460ff16905082565b600080620005c38362000d75565b90506000600182604051620005d9919062001a01565b90815260200160405180910390206040518060400160405290816000820160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020016000820160149054906101000a900460ff16151515158152505090508060200151156200067f5780600001519250505062000686565b6000925050505b919050565b6000620006988462000d75565b90503073ffffffffffffffffffffffffffffffffffffffff1663261a323e826040518263ffffffff1660e01b8152600401620006d5919062001b20565b60206040518083038186803b158015620006ee57600080fd5b505afa15801562000703573d6000803e3d6000fd5b505050506040513d601f19601f8201168201806040525081019062000729919062001609565b6200076b576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401620007629062001bbc565b60405180910390fd5b60003073ffffffffffffffffffffffffffffffffffffffff1663a2cc6981836040518263ffffffff1660e01b8152600401620007a8919062001b20565b60206040518083038186803b158015620007c157600080fd5b505afa158015620007d6573d6000803e3d6000fd5b505050506040513d601f19601f82011682018060405250810190620007fc9190620015d7565b905060003390506200081082828662000d89565b6200081a62000e05565b8473ffffffffffffffffffffffffffffffffffffffff168173ffffffffffffffffffffffffffffffffffffffff168460405162000858919062001a01565b60405180910390207ff07f3d01c044b843c18899f3968196f19e414f2dfc711a765a1aa41281f7afc4876000546040516200089592919062001c3f565b60405180910390a4505050505050565b600080602067ffffffffffffffff811115620008c657620008c562002022565b5b6040519080825280601f01601f191660200182016040528015620008f95781602001600182028036833780820191505090505b50905060008060b573ffffffffffffffffffffffffffffffffffffffff1683604051620009279190620019e8565b6000604051808303816000865af19150503d806000811462000966576040519150601f19603f3d011682016040523d82523d6000602084013e6200096b565b606091505b509150915081620009b3576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401620009aa9062001b9a565b60405180910390fd5b6000620009c08262000e22565b90506001811494508462000a0b576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040162000a029062001c00565b60405180910390fd5b600062000a188c62000d75565b90503073ffffffffffffffffffffffffffffffffffffffff1663261a323e826040518263ffffffff1660e01b815260040162000a55919062001b20565b60206040518083038186803b15801562000a6e57600080fd5b505afa15801562000a83573d6000803e3d6000fd5b505050506040513d601f19601f8201168201806040525081019062000aa9919062001609565b62000ac85762000ac78162000ac1838e8e8e62000f1b565b62000f73565b5b60003073ffffffffffffffffffffffffffffffffffffffff1663a2cc6981836040518263ffffffff1660e01b815260040162000b05919062001b20565b60206040518083038186803b15801562000b1e57600080fd5b505afa15801562000b33573d6000803e3d6000fd5b505050506040513d601f19601f8201168201806040525081019062000b599190620015d7565b905062000b68818a8a6200124b565b8873ffffffffffffffffffffffffffffffffffffffff168260405162000b8f919062001a01565b60405180910390207f4447df32d078a22540f11de3ca36c2145245056e49a8c3ea40135fa7d66873138a60405162000bc8919062001c22565b60405180910390a350505050505050505050505050565b60005481565b60606000600260008473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060405180604001604052908160008201805462000c459062001edb565b80601f016020809104026020016040519081016040528092919081815260200182805462000c739062001edb565b801562000cc45780601f1062000c985761010080835404028352916020019162000cc4565b820191906000526020600020905b81548152906001019060200180831162000ca657829003601f168201915b505050505081526020016001820160009054906101000a900460ff161515151581525050905080602001511562000d0357806000015191505062000d17565b604051806020016040528060008152509150505b919050565b6000600260008373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060010160009054906101000a900460ff169050919050565b606062000d8282620012c7565b9050919050565b60008390508073ffffffffffffffffffffffffffffffffffffffff16639dc29fac84846040518363ffffffff1660e01b815260040162000dcb92919062001ad6565b600060405180830381600087803b15801562000de657600080fd5b505af115801562000dfb573d6000803e3d6000fd5b5050505050505050565b600160008082825462000e19919062001d08565b92505081905550565b600080600083519050602081111562000e72576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040162000e699062001bde565b60405180910390fd5b60005b8181101562000f0d5760088183602062000e90919062001e04565b62000e9c919062001d08565b62000ea8919062001da3565b60ff60f81b86838151811062000ec35762000ec262001ff3565b5b602001015160f81c60f81b167effffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff1916901c83179250808062000f049062001f47565b91505062000e75565b508160001c92505050919050565b6000803090506000818787878760405162000f3690620013f6565b62000f4695949392919062001a64565b604051809103906000f08015801562000f63573d6000803e3d6000fd5b5090508092505050949350505050565b600062000f808362000d75565b90503073ffffffffffffffffffffffffffffffffffffffff1663261a323e826040518263ffffffff1660e01b815260040162000fbd919062001b20565b60206040518083038186803b15801562000fd657600080fd5b505afa15801562000feb573d6000803e3d6000fd5b505050506040513d601f19601f8201168201806040525081019062001011919062001609565b1562001054576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016200104b9062001b78565b60405180910390fd5b60405180604001604052808373ffffffffffffffffffffffffffffffffffffffff1681526020016001151581525060018260405162001094919062001a01565b908152602001604051809103902060008201518160000160006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff16021790555060208201518160000160146101000a81548160ff021916908315150217905550905050604051806040016040528082815260200160011515815250600260008473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060008201518160000190805190602001906200118192919062001404565b5060208201518160010160006101000a81548160ff0219169083151502179055509050506003829080600181540180825580915050600190039060005260206000200160009091909190916101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055506004819080600181540180825580915050600190039060005260206000200160009091909190915090805190602001906200124592919062001404565b50505050565b60008390508073ffffffffffffffffffffffffffffffffffffffff166340c10f1984846040518363ffffffff1660e01b81526004016200128d92919062001ad6565b600060405180830381600087803b158015620012a857600080fd5b505af1158015620012bd573d6000803e3d6000fd5b5050505050505050565b6060600082905060005b8151811015620013615762001306828281518110620012f557620012f462001ff3565b5b602001015160f81c60f81b6200136b565b8282815181106200131c576200131b62001ff3565b5b60200101907effffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff1916908160001a9053508080620013589062001f47565b915050620012d1565b5080915050919050565b6000604160f81b827effffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff191610158015620013ca5750605a60f81b827effffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff191611155b15620013ed5760208260f81c620013e2919062001d65565b60f81b9050620013f1565b8190505b919050565b611fff80620022b683390190565b828054620014129062001edb565b90600052602060002090601f01602090048101928262001436576000855562001482565b82601f106200145157805160ff191683800117855562001482565b8280016001018555821562001482579182015b828111156200148157825182559160200191906001019062001464565b5b50905062001491919062001495565b5090565b5b80821115620014b057600081600090555060010162001496565b5090565b6000620014cb620014c58462001c95565b62001c6c565b905082815260208101848484011115620014ea57620014e962002056565b5b620014f784828562001e96565b509392505050565b60008135905062001510816200224d565b92915050565b60008151905062001527816200224d565b92915050565b6000815190506200153e8162002267565b92915050565b600082601f8301126200155c576200155b62002051565b5b81356200156e848260208601620014b4565b91505092915050565b600081359050620015888162002281565b92915050565b6000813590506200159f816200229b565b92915050565b600060208284031215620015be57620015bd62002060565b5b6000620015ce84828501620014ff565b91505092915050565b600060208284031215620015f057620015ef62002060565b5b6000620016008482850162001516565b91505092915050565b60006020828403121562001622576200162162002060565b5b600062001632848285016200152d565b91505092915050565b60006020828403121562001654576200165362002060565b5b600082013567ffffffffffffffff8111156200167557620016746200205b565b5b620016838482850162001544565b91505092915050565b600080600060608486031215620016a857620016a762002060565b5b600084013567ffffffffffffffff811115620016c957620016c86200205b565b5b620016d78682870162001544565b9350506020620016ea86828701620014ff565b9250506040620016fd8682870162001577565b9150509250925092565b60008060008060008060c0878903121562001727576200172662002060565b5b600087013567ffffffffffffffff8111156200174857620017476200205b565b5b6200175689828a0162001544565b965050602087013567ffffffffffffffff8111156200177a57620017796200205b565b5b6200178889828a0162001544565b955050604087013567ffffffffffffffff811115620017ac57620017ab6200205b565b5b620017ba89828a0162001544565b9450506060620017cd89828a016200158e565b9350506080620017e089828a01620014ff565b92505060a0620017f389828a0162001577565b9150509295509295509295565b60006020828403121562001819576200181862002060565b5b6000620018298482850162001577565b91505092915050565b6200183d8162001e3f565b82525050565b6200184e8162001e53565b82525050565b6000620018618262001ccb565b6200186d818562001ce1565b93506200187f81856020860162001ea5565b80840191505092915050565b6000620018988262001cd6565b620018a4818562001cec565b9350620018b681856020860162001ea5565b620018c18162002065565b840191505092915050565b6000620018d98262001cd6565b620018e5818562001cfd565b9350620018f781856020860162001ea5565b80840191505092915050565b60006200191260398362001cec565b91506200191f8262002076565b604082019050919050565b600062001939604d8362001cec565b91506200194682620020c5565b606082019050919050565b60006200196060448362001cec565b91506200196d826200213a565b606082019050919050565b60006200198760258362001cec565b91506200199482620021af565b604082019050919050565b6000620019ae60388362001cec565b9150620019bb82620021fe565b604082019050919050565b620019d18162001e7f565b82525050565b620019e28162001e89565b82525050565b6000620019f6828462001854565b915081905092915050565b600062001a0f8284620018cc565b915081905092915050565b600060208201905062001a31600083018462001832565b92915050565b600060408201905062001a4e600083018562001832565b62001a5d602083018462001843565b9392505050565b600060a08201905062001a7b600083018862001832565b818103602083015262001a8f81876200188b565b9050818103604083015262001aa581866200188b565b9050818103606083015262001abb81856200188b565b905062001acc6080830184620019d7565b9695505050505050565b600060408201905062001aed600083018562001832565b62001afc6020830184620019c6565b9392505050565b600060208201905062001b1a600083018462001843565b92915050565b6000602082019050818103600083015262001b3c81846200188b565b905092915050565b6000604082019050818103600083015262001b6081856200188b565b905062001b71602083018462001843565b9392505050565b6000602082019050818103600083015262001b938162001903565b9050919050565b6000602082019050818103600083015262001bb5816200192a565b9050919050565b6000602082019050818103600083015262001bd78162001951565b9050919050565b6000602082019050818103600083015262001bf98162001978565b9050919050565b6000602082019050818103600083015262001c1b816200199f565b9050919050565b600060208201905062001c396000830184620019c6565b92915050565b600060408201905062001c566000830185620019c6565b62001c656020830184620019c6565b9392505050565b600062001c7862001c8b565b905062001c86828262001f11565b919050565b6000604051905090565b600067ffffffffffffffff82111562001cb35762001cb262002022565b5b62001cbe8262002065565b9050602081019050919050565b600081519050919050565b600081519050919050565b600081905092915050565b600082825260208201905092915050565b600081905092915050565b600062001d158262001e7f565b915062001d228362001e7f565b9250827fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff0382111562001d5a5762001d5962001f95565b5b828201905092915050565b600062001d728262001e89565b915062001d7f8362001e89565b92508260ff0382111562001d985762001d9762001f95565b5b828201905092915050565b600062001db08262001e7f565b915062001dbd8362001e7f565b9250817fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff048311821515161562001df95762001df862001f95565b5b828202905092915050565b600062001e118262001e7f565b915062001e1e8362001e7f565b92508282101562001e345762001e3362001f95565b5b828203905092915050565b600062001e4c8262001e5f565b9050919050565b60008115159050919050565b600073ffffffffffffffffffffffffffffffffffffffff82169050919050565b6000819050919050565b600060ff82169050919050565b82818337600083830152505050565b60005b8381101562001ec557808201518184015260208101905062001ea8565b8381111562001ed5576000848401525b50505050565b6000600282049050600182168062001ef457607f821691505b6020821081141562001f0b5762001f0a62001fc4565b5b50919050565b62001f1c8262002065565b810181811067ffffffffffffffff8211171562001f3e5762001f3d62002022565b5b80604052505050565b600062001f548262001e7f565b91507fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff82141562001f8a5762001f8962001f95565b5b600182019050919050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052601160045260246000fd5b7f4e487b7100000000000000000000000000000000000000000000000000000000600052602260045260246000fd5b7f4e487b7100000000000000000000000000000000000000000000000000000000600052603260045260246000fd5b7f4e487b7100000000000000000000000000000000000000000000000000000000600052604160045260246000fd5b600080fd5b600080fd5b600080fd5b600080fd5b6000601f19601f8301169050919050565b7f566f75636865724d61702e616464566f75636865723a20616e20766f7563686560008201527f7220636f6e747261637420616c72656164792065786973747300000000000000602082015250565b7f537562636861696e544675656c546f6b656e42616e6b2e70726976696c65676560008201527f644163636573734f6e6c793a206661696c656420746f20636865636b2074686560208201527f20616363657373206c6576656c00000000000000000000000000000000000000604082015250565b7f537562636861696e544e543230546f6b656e42616e6b2e6275726e566f75636860008201527f6572733a20766f756368657220636f6e747261637420646f6573206e6f74206560208201527f7869737400000000000000000000000000000000000000000000000000000000604082015250565b7f627974657320746f2075696e7432353620636f6e76657273696f6e206f76657260008201527f666c6f7773000000000000000000000000000000000000000000000000000000602082015250565b7f566f75636865724d61702e70726976696c656765644163636573734f6e6c793a60008201527f20696e73756666696369656e742070726976696c656765730000000000000000602082015250565b620022588162001e3f565b81146200226457600080fd5b50565b620022728162001e53565b81146200227e57600080fd5b50565b6200228c8162001e7f565b81146200229857600080fd5b50565b620022a68162001e89565b8114620022b257600080fd5b5056fe60806040523480156200001157600080fd5b5060405162001fff38038062001fff83398181016040528101906200003791906200024b565b848383816003908051906020019062000052929190620000ef565b5080600490805190602001906200006b929190620000ef565b50505080600560006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff160217905550508360069080519060200190620000c8929190620000ef565b5080600760006101000a81548160ff021916908360ff160217905550505050505062000529565b828054620000fd9062000406565b90600052602060002090601f0160209004810192826200012157600085556200016d565b82601f106200013c57805160ff19168380011785556200016d565b828001600101855582156200016d579182015b828111156200016c5782518255916020019190600101906200014f565b5b5090506200017c919062000180565b5090565b5b808211156200019b57600081600090555060010162000181565b5090565b6000620001b6620001b08462000359565b62000330565b905082815260208101848484011115620001d557620001d4620004d5565b5b620001e2848285620003d0565b509392505050565b600081519050620001fb81620004f5565b92915050565b600082601f830112620002195762000218620004d0565b5b81516200022b8482602086016200019f565b91505092915050565b60008151905062000245816200050f565b92915050565b600080600080600060a086880312156200026a5762000269620004df565b5b60006200027a88828901620001ea565b955050602086015167ffffffffffffffff8111156200029e576200029d620004da565b5b620002ac8882890162000201565b945050604086015167ffffffffffffffff811115620002d057620002cf620004da565b5b620002de8882890162000201565b935050606086015167ffffffffffffffff811115620003025762000301620004da565b5b620003108882890162000201565b9250506080620003238882890162000234565b9150509295509295909350565b60006200033c6200034f565b90506200034a82826200043c565b919050565b6000604051905090565b600067ffffffffffffffff821115620003775762000376620004a1565b5b6200038282620004e4565b9050602081019050919050565b60006200039c82620003a3565b9050919050565b600073ffffffffffffffffffffffffffffffffffffffff82169050919050565b600060ff82169050919050565b60005b83811015620003f0578082015181840152602081019050620003d3565b8381111562000400576000848401525b50505050565b600060028204905060018216806200041f57607f821691505b6020821081141562000436576200043562000472565b5b50919050565b6200044782620004e4565b810181811067ffffffffffffffff82111715620004695762000468620004a1565b5b80604052505050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052602260045260246000fd5b7f4e487b7100000000000000000000000000000000000000000000000000000000600052604160045260246000fd5b600080fd5b600080fd5b600080fd5b600080fd5b6000601f19601f8301169050919050565b62000500816200038f565b81146200050c57600080fd5b50565b6200051a81620003c3565b81146200052657600080fd5b50565b611ac680620005396000396000f3fe608060405234801561001057600080fd5b50600436106100f55760003560e01c806370a0823111610097578063a457c2d711610066578063a457c2d714610288578063a9059cbb146102b8578063c370b042146102e8578063dd62ed3e14610306576100f5565b806370a08231146102005780638da5cb5b1461023057806395d89b411461024e5780639dc29fac1461026c576100f5565b806323b872dd116100d357806323b872dd14610166578063313ce5671461019657806339509351146101b457806340c10f19146101e4576100f5565b806306fdde03146100fa578063095ea7b31461011857806318160ddd14610148575b600080fd5b610102610336565b60405161010f91906113bd565b60405180910390f35b610132600480360381019061012d9190611151565b6103c8565b60405161013f91906113a2565b60405180910390f35b6101506103eb565b60405161015d919061153f565b60405180910390f35b610180600480360381019061017b91906110fe565b6103f5565b60405161018d91906113a2565b60405180910390f35b61019e610424565b6040516101ab919061155a565b60405180910390f35b6101ce60048036038101906101c99190611151565b61043b565b6040516101db91906113a2565b60405180910390f35b6101fe60048036038101906101f99190611151565b610472565b005b61021a60048036038101906102159190611091565b6104da565b604051610227919061153f565b60405180910390f35b610238610522565b6040516102459190611387565b60405180910390f35b610256610548565b60405161026391906113bd565b60405180910390f35b61028660048036038101906102819190611151565b6105da565b005b6102a2600480360381019061029d9190611151565b610693565b6040516102af91906113a2565b60405180910390f35b6102d260048036038101906102cd9190611151565b61070a565b6040516102df91906113a2565b60405180910390f35b6102f061072d565b6040516102fd91906113bd565b60405180910390f35b610320600480360381019061031b91906110be565b6107bf565b60405161032d919061153f565b60405180910390f35b606060038054610345906116a3565b80601f0160208091040260200160405190810160405280929190818152602001828054610371906116a3565b80156103be5780601f10610393576101008083540402835291602001916103be565b820191906000526020600020905b8154815290600101906020018083116103a157829003601f168201915b5050505050905090565b6000806103d3610846565b90506103e081858561084e565b600191505092915050565b6000600254905090565b600080610400610846565b905061040d858285610a19565b610418858585610aa5565b60019150509392505050565b6000600760009054906101000a900460ff16905090565b600080610446610846565b905061046781858561045885896107bf565b6104629190611591565b61084e565b600191505092915050565b600560009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff16146104cc57600080fd5b6104d68282610d26565b5050565b60008060008373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020549050919050565b600560009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1681565b606060048054610557906116a3565b80601f0160208091040260200160405190810160405280929190818152602001828054610583906116a3565b80156105d05780601f106105a5576101008083540402835291602001916105d0565b820191906000526020600020905b8154815290600101906020018083116105b357829003601f168201915b5050505050905090565b600560009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff161461063457600080fd5b600061063f836104da565b905081811015610684576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161067b906114df565b60405180910390fd5b61068e8383610e86565b505050565b60008061069e610846565b905060006106ac82866107bf565b9050838110156106f1576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016106e8906114ff565b60405180910390fd5b6106fe828686840361084e565b60019250505092915050565b600080610715610846565b9050610722818585610aa5565b600191505092915050565b60606006805461073c906116a3565b80601f0160208091040260200160405190810160405280929190818152602001828054610768906116a3565b80156107b55780601f1061078a576101008083540402835291602001916107b5565b820191906000526020600020905b81548152906001019060200180831161079857829003601f168201915b5050505050905090565b6000600160008473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060008373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002054905092915050565b600033905090565b600073ffffffffffffffffffffffffffffffffffffffff168373ffffffffffffffffffffffffffffffffffffffff1614156108be576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016108b5906114bf565b60405180910390fd5b600073ffffffffffffffffffffffffffffffffffffffff168273ffffffffffffffffffffffffffffffffffffffff16141561092e576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016109259061141f565b60405180910390fd5b80600160008573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060008473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020819055508173ffffffffffffffffffffffffffffffffffffffff168373ffffffffffffffffffffffffffffffffffffffff167f8c5be1e5ebec7d5bd14f71427d1e84f3dd0314c0f7b2291e5b200ac8c7c3b92583604051610a0c919061153f565b60405180910390a3505050565b6000610a2584846107bf565b90507fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff8114610a9f5781811015610a91576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401610a889061143f565b60405180910390fd5b610a9e848484840361084e565b5b50505050565b600073ffffffffffffffffffffffffffffffffffffffff168373ffffffffffffffffffffffffffffffffffffffff161415610b15576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401610b0c9061149f565b60405180910390fd5b600073ffffffffffffffffffffffffffffffffffffffff168273ffffffffffffffffffffffffffffffffffffffff161415610b85576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401610b7c906113df565b60405180910390fd5b610b9083838361105d565b60008060008573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002054905081811015610c16576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401610c0d9061145f565b60405180910390fd5b8181036000808673ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002081905550816000808573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000206000828254610ca99190611591565b925050819055508273ffffffffffffffffffffffffffffffffffffffff168473ffffffffffffffffffffffffffffffffffffffff167fddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef84604051610d0d919061153f565b60405180910390a3610d20848484611062565b50505050565b600073ffffffffffffffffffffffffffffffffffffffff168273ffffffffffffffffffffffffffffffffffffffff161415610d96576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401610d8d9061151f565b60405180910390fd5b610da26000838361105d565b8060026000828254610db49190611591565b92505081905550806000808473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000206000828254610e099190611591565b925050819055508173ffffffffffffffffffffffffffffffffffffffff16600073ffffffffffffffffffffffffffffffffffffffff167fddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef83604051610e6e919061153f565b60405180910390a3610e8260008383611062565b5050565b600073ffffffffffffffffffffffffffffffffffffffff168273ffffffffffffffffffffffffffffffffffffffff161415610ef6576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401610eed9061147f565b60405180910390fd5b610f028260008361105d565b60008060008473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002054905081811015610f88576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401610f7f906113ff565b60405180910390fd5b8181036000808573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020819055508160026000828254610fdf91906115e7565b92505081905550600073ffffffffffffffffffffffffffffffffffffffff168373ffffffffffffffffffffffffffffffffffffffff167fddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef84604051611044919061153f565b60405180910390a361105883600084611062565b505050565b505050565b505050565b60008135905061107681611a62565b92915050565b60008135905061108b81611a79565b92915050565b6000602082840312156110a7576110a6611733565b5b60006110b584828501611067565b91505092915050565b600080604083850312156110d5576110d4611733565b5b60006110e385828601611067565b92505060206110f485828601611067565b9150509250929050565b60008060006060848603121561111757611116611733565b5b600061112586828701611067565b935050602061113686828701611067565b92505060406111478682870161107c565b9150509250925092565b6000806040838503121561116857611167611733565b5b600061117685828601611067565b92505060206111878582860161107c565b9150509250929050565b61119a8161161b565b82525050565b6111a98161162d565b82525050565b60006111ba82611575565b6111c48185611580565b93506111d4818560208601611670565b6111dd81611738565b840191505092915050565b60006111f5602383611580565b915061120082611749565b604082019050919050565b6000611218602283611580565b915061122382611798565b604082019050919050565b600061123b602283611580565b9150611246826117e7565b604082019050919050565b600061125e601d83611580565b915061126982611836565b602082019050919050565b6000611281602683611580565b915061128c8261185f565b604082019050919050565b60006112a4602183611580565b91506112af826118ae565b604082019050919050565b60006112c7602583611580565b91506112d2826118fd565b604082019050919050565b60006112ea602483611580565b91506112f58261194c565b604082019050919050565b600061130d603283611580565b91506113188261199b565b604082019050919050565b6000611330602583611580565b915061133b826119ea565b604082019050919050565b6000611353601f83611580565b915061135e82611a39565b602082019050919050565b61137281611659565b82525050565b61138181611663565b82525050565b600060208201905061139c6000830184611191565b92915050565b60006020820190506113b760008301846111a0565b92915050565b600060208201905081810360008301526113d781846111af565b905092915050565b600060208201905081810360008301526113f8816111e8565b9050919050565b600060208201905081810360008301526114188161120b565b9050919050565b600060208201905081810360008301526114388161122e565b9050919050565b6000602082019050818103600083015261145881611251565b9050919050565b6000602082019050818103600083015261147881611274565b9050919050565b6000602082019050818103600083015261149881611297565b9050919050565b600060208201905081810360008301526114b8816112ba565b9050919050565b600060208201905081810360008301526114d8816112dd565b9050919050565b600060208201905081810360008301526114f881611300565b9050919050565b6000602082019050818103600083015261151881611323565b9050919050565b6000602082019050818103600083015261153881611346565b9050919050565b60006020820190506115546000830184611369565b92915050565b600060208201905061156f6000830184611378565b92915050565b600081519050919050565b600082825260208201905092915050565b600061159c82611659565b91506115a783611659565b9250827fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff038211156115dc576115db6116d5565b5b828201905092915050565b60006115f282611659565b91506115fd83611659565b9250828210156116105761160f6116d5565b5b828203905092915050565b600061162682611639565b9050919050565b60008115159050919050565b600073ffffffffffffffffffffffffffffffffffffffff82169050919050565b6000819050919050565b600060ff82169050919050565b60005b8381101561168e578082015181840152602081019050611673565b8381111561169d576000848401525b50505050565b600060028204905060018216806116bb57607f821691505b602082108114156116cf576116ce611704565b5b50919050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052601160045260246000fd5b7f4e487b7100000000000000000000000000000000000000000000000000000000600052602260045260246000fd5b600080fd5b6000601f19601f8301169050919050565b7f45524332303a207472616e7366657220746f20746865207a65726f206164647260008201527f6573730000000000000000000000000000000000000000000000000000000000602082015250565b7f45524332303a206275726e20616d6f756e7420657863656564732062616c616e60008201527f6365000000000000000000000000000000000000000000000000000000000000602082015250565b7f45524332303a20617070726f766520746f20746865207a65726f20616464726560008201527f7373000000000000000000000000000000000000000000000000000000000000602082015250565b7f45524332303a20696e73756666696369656e7420616c6c6f77616e6365000000600082015250565b7f45524332303a207472616e7366657220616d6f756e742065786365656473206260008201527f616c616e63650000000000000000000000000000000000000000000000000000602082015250565b7f45524332303a206275726e2066726f6d20746865207a65726f2061646472657360008201527f7300000000000000000000000000000000000000000000000000000000000000602082015250565b7f45524332303a207472616e736665722066726f6d20746865207a65726f20616460008201527f6472657373000000000000000000000000000000000000000000000000000000602082015250565b7f45524332303a20617070726f76652066726f6d20746865207a65726f2061646460008201527f7265737300000000000000000000000000000000000000000000000000000000602082015250565b7f566f7563686572206f776e657220646f6573206e6f74206861766520656e6f7560008201527f67682062616c616e636520746f206275726e0000000000000000000000000000602082015250565b7f45524332303a2064656372656173656420616c6c6f77616e63652062656c6f7760008201527f207a65726f000000000000000000000000000000000000000000000000000000602082015250565b7f45524332303a206d696e7420746f20746865207a65726f206164647265737300600082015250565b611a6b8161161b565b8114611a7657600080fd5b50565b611a8281611659565b8114611a8d57600080fd5b5056fea26469706673582212204c0b9fd6309daa0b461cb29e9d2c2f7d5d5273f97c8d4cd8b5d45bbba918377d64736f6c63430008070033a26469706673582212204ed1b98a65fcebb2219c16d99617f5b7fd98499f16bcb07337cdd508547ee52064736f6c63430008070033"

var mintTNT20VouchersFuncSelector = crypto.Keccak256([]byte("mintVouchers(string,string,string,uint8,address,uint256)"))[:4] // In Solidity, uint is an alias of uint256, so we need to use uint256 here to get the correct selector

// TNT20TokenBank implements the TokenBank interface.
type TNT20TokenBank struct {
}

func NewTNT20TokenBank() *TNT20TokenBank {
	return &TNT20TokenBank{}
}

// Mint vouchers for the token transferred cross-chain. If the voucher contract for the token does not yet exist, the
// TokenBank contract deploys the the vouncher contract first and then mints the vouchers in the same call.
// Note: if a user calls the the TNT20TokenBank.mintVouchers() function (e.g. with the following command), the transaction should fail with the "evm revert" error.
//       This is because mintVouchers() is only allowed in the privileged execution context
//       thetasubcli tx smart_contract --chain="tsub_360777" --from=2E833968E5bB786Ae419c4d13189fB081Cc43bab --to=0x5a443704dd4B594B382c22a083e2BD3090A6feF3 --gas_price=4000000000000wei --gas_limit=5000000 --data=ba2c329c00000000000000000000000000000000000000000000000000000000000000c00000000000000000000000000000000000000000000000000000000000000120000000000000000000000000000000000000000000000000000000000000016000000000000000000000000000000000000000000000000000000000000000120000000000000000000000002e833968e5bb786ae419c4d13189fb081cc43bab000000000000000000000000000000000000000000000013c9647e25a994000000000000000000000000000000000000000000000000000000000000000000346d61696e6e65742f312f30783133333637333942303543374162386135323644343044434330643034613832366235663842303300000000000000000000000000000000000000000000000000000000000000000000000000000000000000055444726f7000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000055444524f50000000000000000000000000000000000000000000000000000000 --password=qwertyuiop --seq=2
func (tb *TNT20TokenBank) GenerateMintVouchersProxySctx(blockProposer common.Address, view *slst.StoreView, ccte *core.CrossChainTNT20TransferEvent) (*types.SmartContractTx, error) {
	voucherReceiver := ccte.Receiver
	denom := ccte.Denom
	name := ccte.Name
	symbol := ccte.Symbol
	decimals := ccte.Decimals
	amount := ccte.Amount

	calldata := tb.encodeCalldata(denom, name, symbol, decimals, voucherReceiver, amount)
	tnt20TokenBankContractAddr := view.GetTNT20TokenBankContractAddress()
	sctx, err := constructProxySmartContractTx(blockProposer, *tnt20TokenBankContractAddr, calldata)
	if err != nil {
		return nil, err
	}

	return sctx, nil
}

// Calldata encoding standard: https://medium.com/@libertylocked/what-are-abi-encoding-functions-in-solidity-0-4-24-c1a90b5ddce8
// function mintVouchers(string memory denom, string memory name, string memory symbol, uint8 decimals, address voucherReceiver, uint mintAmount)
// Assume that we pass the following parameters to the function:
//     denom          : mainnet/20/0x1336739B05C7Ab8a526D40DCC0d04a826b5f8B03
//     name           : TDrop
//     symbol         : TDROP
//     decimals       : 18
//     voucherReceiver: 0x2E833968E5bB786Ae419c4d13189fB081Cc43bab
//     mintAmount     : 365000000000000000000
// Then, the calldata for the above function and params is: 0xba2c329c00000000000000000000000000000000000000000000000000000000000000c00000000000000000000000000000000000000000000000000000000000000120000000000000000000000000000000000000000000000000000000000000016000000000000000000000000000000000000000000000000000000000000000120000000000000000000000002e833968e5bb786ae419c4d13189fb081cc43bab000000000000000000000000000000000000000000000013c9647e25a994000000000000000000000000000000000000000000000000000000000000000000356d61696e6e65742f32302f307831333336373339423035433741623861353236443430444343306430346138323662356638423033000000000000000000000000000000000000000000000000000000000000000000000000000000000000055444726f7000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000055444524f50000000000000000000000000000000000000000000000000000000
//
// Let's break the above calldata into parts, and see what each part represents:
//
// ba2c329c // the function selector, i.e mintTNT20VouchersFuncSelector
// 00000000000000000000000000000000000000000000000000000000000000c0 // offset of the first parameter, i.e denom
// 0000000000000000000000000000000000000000000000000000000000000120 // offset of the second parameter, i.e name
// 0000000000000000000000000000000000000000000000000000000000000160 // offset of the third parameter, i.e symbol
// 0000000000000000000000000000000000000000000000000000000000000012 // decimals, 0x12 = 18
// 0000000000000000000000002e833968e5bb786ae419c4d13189fb081cc43bab // voucherReceiver, left padded to 32 bytes with zeros
// 000000000000000000000000000000000000000000000013c9647e25a9940000 // mintAmount, left padded to 32 bytes with zeros, 0x13c9647e25a9940000 = 365000000000000000000
// 0000000000000000000000000000000000000000000000000000000000000035 // length of the first parameter (i.e. denom), 0x35 = 53 = len("6d61696e6e65742f32302f307831333336373339423035433741623861353236443430444343306430346138323662356638423033") / 2
// 6d61696e6e65742f32302f307831333336373339423035433741623861353236 // denom, right padded to 64 bytes with zeros, where "6d61....3033" is the UTF8-Hex encoding of "mainnet/20/0x1336739B05C7Ab8a526D40DCC0d04a826b5f8B03"
// 4434304443433064303461383236623566384230330000000000000000000000
// 0000000000000000000000000000000000000000000000000000000000000005 // length of the second parameter (i.e. name), 0x05 = 5 = len("5444726f70") / 2
// 5444726f70000000000000000000000000000000000000000000000000000000 // name, right padded to 64 bytes with zeros, where "5444726f70" is the UTF8-Hex encoding of "TDrop"
// 0000000000000000000000000000000000000000000000000000000000000005 // length of the third parameter (i.e. symbol), 0x05 = 5 = len("5444524f50") / 2
// 5444524f50000000000000000000000000000000000000000000000000000000 // symbol, right padded to 64 bytes with zeros, where "5444524f50" is the UTF8-Hex encoding of "TDROP"
//
func (tb *TNT20TokenBank) encodeCalldata(denom string, name string, symbol string, decimals uint8, voucherReceiver common.Address, mintAmount *big.Int) []byte {
	denomData, denomSize := packStringParam(denom)
	nameData, nameSize := packStringParam(name)
	symbolData, _ := packStringParam(symbol)

	denomParamOffset := 6 * wordSizeInBytes // 6: the offsets of the three string params, plus decimals, voucherReceiver, and mintAmount that fit into one word
	nameParamOffset := denomParamOffset + denomSize
	symbolParamOffset := nameParamOffset + nameSize

	// the function selector
	calldata := append([]byte{}, mintTNT20VouchersFuncSelector...)

	// the offsets
	calldata = append(calldata, packUintParam(denomParamOffset)...)
	calldata = append(calldata, packUintParam(nameParamOffset)...)
	calldata = append(calldata, packUintParam(symbolParamOffset)...)

	// the params that can fit into one word
	calldata = append(calldata, packUintParam(uint(decimals))...)
	calldata = append(calldata, packAddressParam(voucherReceiver)...)
	calldata = append(calldata, packBigIntParam(mintAmount)...)

	// rest of the params
	calldata = append(calldata, denomData...)
	calldata = append(calldata, nameData...)
	calldata = append(calldata, symbolData...)

	logger.Debugf("mint TNT20 voucher sctx calldata: %v", hex.EncodeToString(calldata))

	return calldata
}
